name: Create Pull Request on Issue Close
on:
  issues:
    types:
      - closed

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    steps:
      - name: Check if issue has a selected branch
        id: check_branch
        run: |
          branch_name=$(jq -r '.issue.pull_request.base.ref' "$GITHUB_EVENT_PATH")
          if [[ -z "$branch_name" ]]; then
            echo "No selected branch found for the issue."
            exit 0
          fi
          echo "::set-output name=branch::${branch_name}"

      - name: Create branch from selected branch
        uses: actions/checkout@v4
        with:
          ref: ${{ steps.check_branch.outputs.branch }}
          path: new-branch

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          branch: new-branch
          title: "Auto-generated Pull Request"
          body: |
            This pull request is automatically created when the corresponding issue is closed.
            Issue: ${{ github.event.issue.html_url }}
          token: ${{ secrets._GITHUB_TOKEN }}
